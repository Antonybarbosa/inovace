SELECT

DIA_MES,
SUM(ANO_ANTERIOR) AS ANO_ANTERIOR,
SUM(ANO_ATUAL) AS ANO_ATUAL

FROM

(SELECT 

TO_CHAR(CAB.DTFATUR,'MM/DD') DIA_MES,
--COUNT(DISTINCT(CAB.CODPARC)) AS PARCEIROS 
NVL(COUNT(DISTINCT(CASE WHEN TO_CHAR(CAB.DTFATUR,'YYYY') = to_char((ADD_MONTHS( :DTINI, -12)),'YYYY') THEN
     CAB.CODPARC        END)),0) AS ANO_ANTERIOR,
     
NVL(COUNT(DISTINCT(CASE WHEN TO_CHAR(CAB.DTFATUR,'YYYY') = to_char((to_date( :DTINI,'DD/MM/YYYY')),'YYYY') THEN
     CAB.CODPARC        END)),0) AS ANO_ATUAL    
     
     


FROM 

TGFITE ITE,
TGFCAB CAB,
TGFPRO PR,
TGFPAR PAR,
TGFTPP TPP

WHERE 
CAB.NUNOTA = ITE.NUNOTA AND
PR.CODPROD = ITE.CODPROD AND
CAB.CODPARC = PAR.CODPARC AND
PAR.CODTIPPARC = TPP.CODTIPPARC AND


PR.CODPROD IN ( 5407,	1318,	1319,	1137,	1292,	2453,	161,	162,	163,	
5212,	164,	1317,	1320,	1321,	1323,	1322,	4149,	147,	148,	149,	
1850,	150,	1129,	2452,	170,	171,	1483,	172,	2424,	2426,	1324,	
1325,	1326
)  AND
(TRUNC(CAB.DTFATUR) BETWEEN to_date(:DTINI,'dd/mm/yyyy')-365 AND to_date(:DTFIM,'dd/mm/yyyy')-365  OR
TRUNC(CAB.DTFATUR) BETWEEN :DTINI AND :DTFIM) AND
CAB.TIPMOV = 'V' AND
CAB.STATUSNOTA = 'L' AND
CAB.CODTIPOPER IN ( 700, 703, 706, 707, 709, 715, 723,724, 725) AND
TPP.CODTIPPARC  IN(10101001, 10101004, 10101008, 10101010)
GROUP BY  TO_CHAR(CAB.DTFATUR,'MM/DD'),TO_CHAR(CAB.DTFATUR,'YYYY') ORDER BY DIA_MES DESC) GROUP BY DIA_MES ORDER BY DIA_MES asc